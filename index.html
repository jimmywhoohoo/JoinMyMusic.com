<head>
    <title>ssamjh's Music Sync</title>
    <script type="text/javascript" src="//code.jquery.com/jquery-3.6.0.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="//pages.github.com/css/pages.css" type="text/css">
    <link rel="stylesheet" href="css/buttons.css">
</head>

<body>
    <center>
        <h2>ssamjh's Music Sync</h2>
        <h3>joinmymusic.com</h3>
        <br>
        <audio id="audio-stream" preload="auto"></audio>
        <br>
        <a><b>Stream Quality:</b></a>
        <select name="select-quality" id="select-quality" onchange="qualityUpdate();">
		  <option value="audiophile" title="You are so cool that you need your own water supply.&#13;&#10;&#13;&#10;16bit FLAC">Audiophile</option>
		  <option value="high" selected="selected" title="For those premium people that enjoy premium audio.&#13;&#10;&#13;&#10;256Kbps Opus">High</option>
		  <option value="normal" title="Smack-bang in the middle. Perfect for the normies.&#13;&#10;&#13;&#10;128Kbps Opus">Normal</option>
		  <option value="low" title="Do you struggle with internet? This stream will literally work on dialup.&#13;&#10;&#13;&#10;32Kbps HE-AAC">Low</option>
		</select>
        <br>
        <br>
        <button class="small button" id="button-play" onclick="buttonPlay();">Play</button>
        <br>
        <button class="small button" id="button-stop" onclick="buttonStop();">Stop</button>
        <br>
        <br>
        <div id="div-volume">
            <br>
            <a><b>Volume: </b></a>
            <label class="volume-percentage" for="volume-percentage">10</label>
            <br>
            <input id="input-volume" type="range" min="0" max="100" step="0.1" value="10" class="input-volume" oninput="volumeSet(this.value)" onchange="volumeSet(this.value)"></input>
        </div>
        <br>
        <a><b>Now Playing: </b></a>
        <h4 style="font-size:16">
            <div class="div-playing-title"></div>
        </h4>
        <h4 style="font-size:12">
            <div class="div-playing-artist"></div>
        </h4>
        <br>
        <div class="div-playing-image">
            <a id="playing-link" target="_blank"><img id="playing-image" alt="Now playing image" width="200" height="200"></a>
        </div>
        <br>
    </center>
    <footer class="page-footer">
        <ul class="site-footer-links right">
            <li><a href="https://ssamjh.nz/">Primary Website</a></li>
        </ul>

        <a href="https://github.com/ssamjh/Music-Sync-Web">
            <span class="mega-octicon octicon-mark-github"></span>
        </a>

        <ul class="site-footer-links">
            <li>Â© 2022 <span>ssamjh</span></li>
        </ul>
    </footer>
    <script type="text/javascript">
        if (navigator.userAgent.toLowerCase().match(/mobile/i)) {
            window.onload = function() {
                document.getElementById('audio-stream').volume = 1.0;
                console.log('Setting mobile volume to: 100');
                document.getElementById('button-stop').style.visibility = 'hidden';
                console.log('Hiding stop button');
                var elem = document.getElementById("div-volume");
                elem.remove();
                console.log('Hiding volume controls');
                qualitySet('//icecast.sjh.at/spotifynet-hq');
                console.log('Setting default audio URL');
            }
        } else {
            window.onload = function() {
                document.getElementById('audio-stream').volume = 0.1;
                console.log('Setting default volume to: 10');
                document.getElementById('button-stop').style.visibility = 'hidden';
                console.log('Hiding stop button');
                qualitySet('//icecast.sjh.at/spotifynet-hq');
                console.log('Setting default audio URL');
            }
        }

        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.body.style.backgroundColor = "#222";
            document.body.style.color = "gray";
        }
    </script>
    <script type="text/javascript">
        function qualitySet(source) {
            document.getElementById("audio-stream").pause();
            console.log('Paused player');
            document.getElementById("audio-stream").setAttribute('src', source);
            console.log('Set source to: ' + source);
        }

        function qualityUpdate() {

            var zone = document.getElementById("select-quality");

            if (zone.value == "audiophile") {

                qualitySet('//icecast.sjh.at/spotifynet-uhq');
                buttonPlay();
            } else if (zone.value == "high") {

                qualitySet('//icecast.sjh.at/spotifynet-hq');
                buttonPlay();
            } else if (zone.value == "normal") {

                qualitySet('//icecast.sjh.at/spotifynet');
                buttonPlay();
            } else if (zone.value == "low") {

                qualitySet('//icecast.sjh.at/spotifynet-lq');
                buttonPlay();
            }
        }
    </script>
    <script type="text/javascript">
        function buttonPlay() {
            document.getElementById("audio-stream").load();
            console.log('Loading source');
            document.getElementById("audio-stream").play();
            console.log('Playing audio');
            document.getElementById('button-stop').style.visibility = 'visible';
            console.log('Showing stop button');
            document.getElementById('button-play').style.visibility = 'hidden';
            console.log('Hiding play button');
        }

        function buttonStop() {
            document.getElementById('audio-stream').pause();
            console.log('Stopping audio');
            document.getElementById('button-stop').style.visibility = 'hidden';
            console.log('Hiding stop button');
            document.getElementById('button-play').style.visibility = 'visible';
            console.log('Showing play button');
        }
    </script>
    <script type="text/javascript">
        function volumeSet(val) {
            var player = document.getElementById('audio-stream');
            player.volume = val / 100;
        }

        document.querySelector("#input-volume").addEventListener("input", function(e) {
            document.querySelector(".volume-percentage").textContent = e.currentTarget.value;
            console.log('Volume changed: ' + e.currentTarget.value + '');
        })
    </script>
    <script type="text/javascript">
        function trackArtist() {
            $.get('//joinmymusic.com/nowplaying/Snip_Artist.txt?rand=' + Math.random(), function(data) {
                $(".div-playing-artist").text(data);
                console.log('Refreshing metadata');
            });
        }
        trackArtist()
        setInterval(trackArtist, 10000);

        function trackName() {
            $.get('//joinmymusic.com/nowplaying/Snip_Track.txt?rand=' + Math.random(), function(data) {
                $(".div-playing-title").text(data);
            });
        }
        trackName()
        setInterval(trackName, 10000);

        function trackImage() {
            var myImageElement = document.getElementById('playing-image');
            myImageElement.src = '//joinmymusic.com/nowplaying/Snip_Artwork.jpg?rand=' + Math.random();
        }
        trackImage()
        setInterval(trackImage, 10000);

        function trackURL() {
            fetch('//joinmymusic.com/nowplaying/Snip_Trackid.txt')
                .then(response => response.text())
                .then((data) => {
                    var spotifySongID = (data)
                    if (spotifySongID != "") {
                        document.getElementById("playing-link").setAttribute("href", "https://open.spotify.com/track/" + spotifySongID)
                    } else
                        document.getElementById("playing-link").setAttribute("href", "javascript:void(0)")
                })
        }
        trackURL()
        setInterval(trackURL, 10000);
    </script>
</body>